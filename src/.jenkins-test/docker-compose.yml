version: '3.0'
services:

  elasticsearch:
    image: amsterdam/elasticsearch6
    command:  elasticsearch -Ehttp.host=0.0.0.0 -Etransport.host=127.0.0.1

  tests:
    build: ..
    links:
      - elasticsearch:elasticsearch
    environment:
      - ELASTIC_HOST=elasticsearch
      - DATAPUNT_API_URL=${DATAPUNT_API_URL:-https://api.data.amsterdam.nl/}
      - PYTHONPATH=.
    command: bash -c ".jenkins-test/docker-wait.sh && python .jenkins-test/create_test_index.py && pytest"

